# Solution for eshop

#### 角色分类

- 需求方:拥有资源的实体，并将资源开放给市场，以资源通过 某种定价体系换取一定的报酬(例如, ONG 或其它某种资源)。
- 提供方:资源提供者的交易对手方，是需要某种资源的实体，从资源提供者中获取资源的(部分)所有权或者使用权，并为此支付一定的报酬(例如 ONG)。
- 仲裁方:资源提供者和资源需求者在资源交易中都认可的链下纠纷仲裁者。链下产生的纠纷(如资源没有获取到)将由链下仲裁者进行裁定。
- 认证方:具有一定权威性的第三方，拥有自己的资源质量认证体系，根据该体系可以给资源或者资源提供者提供一定方式的认证增强资源或者资源提供者的可信度。认证根据不同的模式可以收取或者不收取认证费用。与没有经过认证的资源相比，经过认证的资源会拥有更多的潜在买家以及可能获得更高的报酬。
- Marketplace:是连系资源提供者和资源需求者的纽带，存储资源的元信息，为资源提供灵活的展示和快捷的搜索，收取交易费用。



#### 数据发布流程

1. 数据提供方需先通过ONS注册后登陆web-app。

2. 提供数据的元信息，包括数据验证方以及仲裁方，并进行存储，等待数据认证方通过数据的认证

   [存储方案](../../../framework/data-storage/README.md)

3. 数据认证通过后，为数据注册生成DataId，并通过Onto Auth 扫码签名进行上链操作

4. 为生成Token提供基本字段和数据，比如生成Token数量，调用DToken合约，通过Onto Auth 扫码签名进行上链操作

5. DataId与Token绑定之后，选择上传Token的数量等，进行数据的上传操作



#### 数据认证流程

1. 数据提供方存储数据之后，数据认证方就会看到数据的具体信息，如果数据符合认证要求，可通过Onto Auth 扫码签名 进行数据的确认。



#### 数据购买流程

1. 需求方需先通过ONS注册后登陆web-app，可在数据中心看到需求方上传的所有数据，选择一条数据可查看具体描述详情。
2. 需求方购买数据之前需要先选择仲裁方以及购买Token的数量，之后通过Onto Auth 扫码签名marketplace合约进行数据的购买操作。
3. 购买之后，需求方可在web-app 的订单中心看到刚才购买的订单，此时用户可通过Token(调用marketplace合约，验证Token的权限和剩余访问次数)来查看此订单的元数据。
   * 若数据不符，需求方可进行申请仲裁操作（调用marketplace合约上链）
   * 若数据符合，需求方可进行收货操作（调用marketplace合约上链），至此购买流程结束
   * 若需求方在挑战期内未进行收货操作，数据提供方可进行收款操作，至此购买流程结束



#### 数据仲裁流程

1. 仲裁方可在web-app 中看到需要仲裁的数据信息

   * 如果判定成功，通过Onto Auth 扫码签名marketplace 仲裁合约进行上链操作
   * 如果判定失败，通过Onto Auth 扫码签名marketplace 仲裁合约进行上链操作

   

   具体仲裁分配，可参照[仲裁合约流程](../../../framework/marketplace/smart-contract-api.md)



#### 数据撤销流程

1. 提供方可根据上传数据时生成的唯一ID，进行数据的撤销操作，通过Onto Auth 扫码签名marketplace 仲裁合约进行上链操作